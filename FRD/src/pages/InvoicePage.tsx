import type { NextPage } from 'next'
import Head from 'next/head'
import Image from 'next/image'
import { Heading } from '../components/Heading'
import { Navbar } from '../components/Navbar'
import invoice from '../styles/Invoice.module.css'
import Link from 'next/link'
import errorPhoto from '../pages/photo/error.png'
import { Footer } from '../components/Footer'
import errorImage from './error.png'
import { Container } from '@mui/system'
import { useEffect, useState } from 'react'
import { Invoice } from '../components/Receipt'

interface Props {
	id: number
	invoiceNumber: string
	status_id: string
	user_id: string
	address_id: string
	totalPrice: number
	product: string
	icon: string
	color: string
	size: string
	number: number
	single_price: number
	status : string
}

const InvoicePage: NextPage = () => {
	const [invoices, setInvoice] = useState<Props[]>([])
	const [invoiceNumber, setInvoicesNumber] = useState<String>('')
	const [invoiceTotalPrice, setInvoicesTotalPrice] = useState<String>('')
	async function fetchInvoice() {
		let res = await fetch(
			`${process.env.NEXT_PUBLIC_ANALYTICS_ID}/Invoice`,
			{
				method: 'GET',
				headers: {
					Authorization: `Bearer ${localStorage.getItem('token')}`
				}
			}
		)

		let invoiceInfo = await res.json()

		let invoice = invoiceInfo.invoiceRecord

		let invoiceNumber = invoiceInfo.invoiceRecord[0].invoiceNumber

		let invoicePrice = invoiceInfo.invoiceRecord[0].totalPrice

		setInvoice(invoice)
		setInvoicesNumber(invoiceNumber)
		setInvoicesTotalPrice(invoicePrice)
	}
	{
	}

	useEffect(() => {
		fetchInvoice()
	}, [setInvoice, setInvoicesTotalPrice, setInvoicesNumber])

	return (
		<div>
			<Head>
				<title>Create Next App</title>
				<meta
					name='description'
					content='Generated by create next app'
				/>
				<link rel='icon' href='/favicon.ico' />
			</Head>
			<Heading />
			<Navbar />

			<div className={invoice.pageBox}>
				<Container>
					<div>
						<h1 className={invoice.Title}>Invoice</h1>

						<span className={invoice.page}>Home. Pages.</span>
						<span className={invoice.nowPage}>Invoice</span>
					</div>
				</Container>
			</div>

			<div className={invoice.box}>
				<div className={invoice.invoiceDiv}>
					<div className={invoice.order}>My Order</div>
					<div className={invoice.texts}>Order Information</div>

					<div className={invoice.text}>
						Order Number:{invoiceNumber}
					</div>
					<div className={invoice.text}>
						Amount:{invoiceTotalPrice}
					</div>
					<div className={invoice.centerLine}>
						<div className={invoice.line}></div>
					</div>

					<div className={invoice.texts}>Delivery Status</div>

					{invoices.map((invoices) => (
						<Invoice
							id={invoices.id}
							invoiceNumber={invoices.invoiceNumber}
							status_id={invoices.status_id}
							user_id={invoices.user_id}
							address_id={invoices.address_id}
							totalPrice={invoices.totalPrice}
							product={invoices.product}
							icon={invoices.icon}
							color={invoices.color}
							size={invoices.size}
							number={0} single_price={invoices.single_price} status={invoices.status}						/>
					))}
				</div>
			</div>
			<Footer />
		</div>
	)
}

export default InvoicePage
